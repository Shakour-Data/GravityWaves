{% raw %}{% extends "base.html" %}

{% block title %}Indicator Analysis{% endblock %}

{% block content %}
<h1>Indicator Analysis</h1>
<p>Explore technical indicators and their analysis to better understand market signals.</p>

<section id="indicator-settings" class="section-container">
    <h2>Settings</h2>
    <form id="indicator-settings-form">
        <label for="ticker">Ticker Symbol:</label>
        <input type="text" id="ticker" name="ticker" placeholder="e.g. AAPL" required />

        <label for="indicator-type">Indicator Type:</label>
        <select id="indicator-type" name="indicator_type" required>
            <option value="rsi">RSI</option>
            <option value="macd">MACD</option>
            <option value="bollinger_bands">Bollinger Bands</option>
            <option value="moving_average">Moving Average</option>
        </select>

        <button type="submit">Generate Analysis</button>
    </form>
</section>

<section id="indicator-results" class="section-container">
    <h2>Analysis Results</h2>
    <div id="indicator-chart-container">
        <canvas id="indicator-chart"></canvas>
    </div>
    <div id="indicator-summary"></div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.getElementById('indicator-settings-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const ticker = document.getElementById('ticker').value;
    const indicatorType = document.getElementById('indicator-type').value;

    fetch('/api/indicator_analysis', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ticker: ticker, indicator_type: indicatorType })
    })
    .then(response => response.json())
    .then(data => {
        const ctx = document.getElementById('indicator-chart').getContext('2d');
        if (window.indicatorChart) {
            window.indicatorChart.destroy();
        }
        window.indicatorChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.dates,
                datasets: [{
                    label: `${indicatorType.toUpperCase()} Value`,
                    data: data.values,
                    borderColor: '#4caf50',
                    fill: false,
                    tension: 0.1
                }]
            },
            options: {
                scales: {
                    x: { display: true, title: { display: true, text: 'Date' } },
                    y: { display: true, title: { display: true, text: 'Value' } }
                }
            }
        });
        document.getElementById('indicator-summary').textContent = `Analysis generated for ${ticker} using ${indicatorType.toUpperCase()}.`;
    })
    .catch(error => {
        console.error('Error fetching indicator data:', error);
        document.getElementById('indicator-summary').textContent = 'Error generating analysis.';
    });
});
</script>
{% endblock %}
{% endraw %}
